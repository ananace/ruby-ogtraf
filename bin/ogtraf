#!/usr/bin/env ruby

require 'ogtraf'

from = ARGV[0]
to = ARGV[1]

avail = OGTraf.journey(from, to)

puts "Upcoming journeys from #{avail.first.from} to #{avail.first.to}:"
avail.each do |j|
  next if j.departure < Time.now

  time_left = j.departure - Time.now

  hours = (time_left / 3600).floor
  minutes = ((time_left % 3600) / 60).floor

  puts
  puts "In #{format('%02d:%02d', hours, minutes)}:" if hours > 0
  puts "In #{minutes} minutes:" if hours == 0

  j.connections.each do |c|
    puts format('- (%s - %s) %s from %s to %s',
                c.departure.strftime('%H:%M'),
                c.arrival.strftime('%H:%M'),
                c.line.to_s,
                c.from.to_s,
                c.to.to_s)
  end
end
